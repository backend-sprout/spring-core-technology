μ΅°ν λΉμ΄ 2κ° μ΄μƒμΌ λ•(λ¬Έμ )       
====================================

`@Autowired`λ” **νƒ€μ…(Type)μ„ κΈ°λ°μΌλ΅ μ΅°νν•λ‹¤.**            
κ·Έλ ‡κΈ°μ— λ™μΌν• νƒ€μ…μ λΉμ΄ 2κ° μ΅΄μ¬ν•λ‹¤λ©΄, μ–΄λ–¤ λΉμ„ μ£Όμ…ν•΄μ•Όν• μ§€ λ¨λ¥΄κΈ°μ— μ—λ¬λ¥Ό λ°μƒμ‹ν‚¨λ‹¤.       
     
```java
@Component    
class FixDiscountPolicy implements DiscountPolicy {}

@Component
class RateDiscountPolicy implements DiscountPolicy {}

@Service
public class SampleService {
    @Autowired
    private DiscountPolicy discountPolicy;
}
```
```sh
NoUniqueBeanDefinitionException: No qualifying bean of type 
'hello.core.discount.DiscountPolicy' available: expected single matching bean 
but found 2: fixDiscountPolicy,rateDiscountPolicy
```

μ„μ™€ κ°™μ€ μ½”λ“κ°€ μ£Όμ–΄μ΅μ„ λ•, `NoUniqueBeanDefinitionException` μ¤λ¥κ°€ λ°μƒν•λ‹¤.
        
λ‹¨νΈμ μΈ ν•΄κ²° λ°©λ²•μΌλ΅ μƒμ„ νƒ€μ…μ΄ μ•„λ‹ κµ¬μ²΄μ μΈ ν•μ„ νƒ€μ…μΌλ΅ μ§€μ •ν•  μλ„ μμ§€λ§,      
**ν•μ„ νƒ€μ…μΌλ΅ μ§€μ •ν•λ” κ²ƒμ€ DIPλ¥Ό μ„λ°°μ‹ν‚¤κ³  μ μ—°μ„±μ„ λ–¨μ–΄λ¨λ¦°λ‹¤λ” λ¬Έμ μ μ— μ‚¬μ©μ— μ•λ§μ§€ μ•λ‹¤.**        
λν•, **μ΄λ¦„λ§ λ‹¤λ¥΄κ³ , μ™„μ „ν λ‘κ°™μ€ νƒ€μ…μ μ¤ν”„λ§ λΉμ΄ 2κ° μμ„ λ•λ” ν•΄κ²°μ΄ μ•λλ‹¤.**      

μ¤ν”„λ§ λΉμ„ μλ™ λ“±λ΅ν•΄μ„ λ¬Έμ λ¥Ό ν•΄κ²°ν•΄λ„ λμ§€λ§, μ•„λμ™€ κ°™μ€ λ°©λ²•μΌλ΅ ν•΄κ²°ν•  μ μλ‹¤.   
   
* @Autowired ν•„λ“λ… λ§¤μΉ­
* @Qualifier -> @Qualifier λΌλ¦¬ λ§¤μΉ­ -> λΉ μ΄λ¦„ μ§€μ •    
* @Primary μ‚¬μ© 

# π“• @Autowired ν•„λ“λ…   
> `@Autowired`λ” λ‹¨μν νƒ€μ…μΌλ΅λ§ μμ΅΄ κ΄€κ³„ μ£Όμ…μ„ μ§„ν–‰ν•λ” κ²ƒμ€ μ•„λ‹λ‹¤.    

`@Autowired`λ” μ•„λμ™€ κ°™μ€ νƒμƒ‰ μ‚¬μ΄ν΄μ„ κ°–λ”λ‹¤.  

1. νƒ€μ… λ§¤μΉ­
2. ν•„λ“ μ΄λ¦„(ν•„λ“ μ΄λ¦„ == λΉ μ΄λ¦„)  
3. νλΌλ―Έν„° μ΄λ¦„(νλΌλ―Έν„° μ΄λ¦„ == λΉ μ΄λ¦„)

μ¦‰, μ—¬λ¬ λΉμ΄ μμΌλ©΄ **νƒ€μ… -> ν•„λ“ μ΄λ¦„/νλΌλ―Έν„° μ΄λ¦„**μΌλ΅ μ¶”κ°€ λ§¤μΉ­μ„ μ§„ν–‰ν•λ‹¤.    
    
**ν•„λ“λ…μ„ κΈ°μ¤€μΌλ΅ μμ΅΄κ΄€κ³„ μ£Όμ…**  
```java  
@Autowired
private DiscountPolicy rateDiscountPolicy
```

**νλΌλ―Έν„° μ΄λ¦„μ„ κΈ°μ¤€μΌλ΅ μμ΅΄κ΄€κ³„ μ£Όμ…**   
```java
    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy rateDiscountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = rateDiscountPolicy;
    }
```

μ„μ™€ κ°™μ΄ λ³€μλ…μ μ΄λ¦„μ„ λΉμ μ‹λ³„ μ΄λ¦„μΌλ΅ μ§€μ •ν•΄μ£Όλ©΄, 
2κ° μ΄μƒμ κ°™μ€ νƒ€μ…μ λΉμ΄ μλ‹¤ν•λ”λΌλ„ μμ΅΄ κ΄€κ³„λ¥Ό μ£Όμ… λ°›μ„ μ μλ‹¤.      
          
# π“ @Qualifier μ‚¬μ©     
`@Qualifier` λ” **μ¶”κ°€ κµ¬λ¶„μ**λ¥Ό λ¶™μ—¬μ£Όλ” λ°©λ²•μ΄λ‹¤.              
μ£Όμ…μ‹ μ¶”κ°€μ μΈ λ°©λ²•μ„ μ κ³µν•λ” κ²ƒμ΄μ§€ **λΉ μ΄λ¦„μ„ λ³€κ²½ν•λ” κ²ƒμ€ μ•„λ‹λ‹¤!**         
**λΉ μ‹λ³„μ„ μ„ν• λ©”νƒ€ λ°μ΄ν„°**λΌκ³  μƒκ°ν•λ©΄ μ΄ν•΄ν•κΈ° νΈν•λ‹¤.         

**RateDiscountPolicy**
```java
@Component
@Qualifier("mainDiscountPolicy")
public class RateDiscountPolicy implements DiscountPolicy {
    ...
}
```    
  
**FixDiscountPolicy**
```
@Component
@Qualifier("subDiscountPolicy")
public class FixDiscountPolicy implements DiscountPolicy {
    ...
}
```  
`@Qualifier`λ” λΉ μ‹λ³„μ„ μ„ν• μ¶”κ°€ κµ¬λ¶„μ,μ‹λ³„ λ©”νƒ€ λ°μ΄ν„° μ κ³µ μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.        
κ·Έλ ‡κΈ°μ— λ™μΌν• νƒ€μ…μ λΉ λ“±λ΅μ‹ `@Qualifier`λ¥Ό ν†µν•΄ μ‹λ³„κµ¬λ¬Έμ„ λ„£μ–΄μ¤€λ‹¤.   
     
**OrderServiceImpl**
```java
    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository, @Qualifier("mainDiscountPolicy") DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy;
    }
``` 
κ°„λ‹¨ν•κ², **μμ΅΄ κ΄€κ³„ μ£Όμ…μ„ λ°›μ„ κ°μ²΄ μ†μ— `@Qualifier("μ‹λ³„μ")`λ¥Ό λ¶™μ—¬μ£Όλ©΄ λλ‹¤.**                   
κ·Έλ¬λ©΄ `DI μ»¨ν…μ΄λ„`μ—μ„ ν•΄λ‹Ήν•λ” μ‹λ³„μλ¥Ό κ°€μ§„ λΉμ„ μ°Ύμ•„μ„ μμ΅΄ κ΄€κ³„ μ£Όμ…μ„ λ§Ίμ–΄μ¤€λ‹¤.          
     
**`@Qualifier`λ” μ‚¬μ© κ°€λ¥ μμ—­(λ‹¨, μ°Έμ΅° λ³€μ μ†μ— λ¶™μ—¬μ•Όν•λ‹¤.)**        
* ν•„λ“ μ£Όμ…
* μƒμ„±μ μ£Όμ…
* Setter μ£Όμ…
* μΌλ° λ©”μ„λ“ μ£Όμ…
   
**@Qualifier λ§¤μΉ­ μμ„ μ •λ¦¬**
1. κ°™μ€ μ‹λ³„μλ¥Ό κ°€μ§„ `@Qualifier`λΌλ¦¬ λ§¤μΉ­    
2. λΉ μ΄λ¦„ λ§¤μΉ­    
3. NoSuchBeanDefinitionException μμ™Έ λ°μƒ   
   
`@Qualifier`λν•, `@Autowired`μ²λΌ     
μ§€μ •ν• μ‹λ³„μλ¥Ό μ΄λ¦„μΌλ΅ κ°–λ” λΉμ„ μ¶”κ°€λ΅ μ°Ύλ”λ‹¤.     
ν•μ§€λ§, `@Qualifier`λ¥Ό μ΄μ©ν• λΉ μ΅°νμ‹μ—λ” μ΄λ¬ν• λ°©μ‹μ„ μ‚¬μ©ν•μ§€ λ§κ³     
**`@Autowired`λ¥Ό μ΄μ©ν• λΉ μ°ΎκΈ° + `@Qualifier` μ¶”κ°€ κµ¬λ¶„μ** λ΅λ§ μ‚¬μ©ν•μ        
       
# π“— @Primary   
> ν•„μ(kwj1270)λ” μ‚¬μ©ν•΄λ³Έ κ²½ν—μ΄ μ—†μ§€λ§, μ‹¤λ¬΄μ—μ„λ” λ§μ΄ μ‚¬μ©ν•λ” μ–΄λ…Έν…μ΄μ… κ°™λ‹¤.     
               
`@Primary`λ” μμ΅΄ κ΄€κ³„ μ£Όμ…μ‹ **μ°μ„ μμ„λ¥Ό μ§€μ •ν•λ” λ©”νƒ€ λ°μ΄ν„° μ–΄λ…Έν…μ΄μ…μ΄λ‹¤.**          
μ‰½κ² μ„¤λ…ν•λ©΄, μ—¬λ¬ λ™μΌν• νƒ€μ…μ λΉλ“¤μ¤‘ `@Primary`κ°€ λ¶™μ€ λΉμ„ μ°μ„ μΌλ΅ μ£Όμ… λ°›λ”λ‹¤.   

**RateDiscountPolicy**
```java
@Component
@Primary
public class RateDiscountPolicy implements DiscountPolicy {
    ...
}
```
**FixDiscountPolicy**
```java
@Component
public class FixDiscountPolicy implements DiscountPolicy {
    ...
}
```
λ™μΌν• νƒ€μ…μ„ κ°€μ§„ λΉμ΄ μ—¬λΏ λ“±λ΅ λ  λ•,      
λ©”μΈμ΄ λλ” λΉμ— `@Primary` μ–΄λ…Έν…μ΄μ…μ„ λ¶™μ—¬μ¤€λ‹¤.      
     
```java
@Component
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository;
    private final DiscountPolicy discountPolicy;

    @Autowired
    public OrderServiceImpl(MemberRepository memberRepository,DiscountPolicy discountPolicy) {
        this.memberRepository = memberRepository;
        this.discountPolicy = discountPolicy; // RateDiscountPolicy κ°€ λ“¤μ–΄μ¨λ‹¤.  
    }
}
```   
`@Primary`κ°€ λ¶™μ—λ λΉμ€ μ°μ„ μμ„λ¥Ό κ°€μ§€κ² λλ” κ²ƒμ΄κΈ°μ— μΌλ°μ μΈ μ£Όμ… λ°©λ²•κ³Ό κ°™μ΄ μ‚¬μ©ν•  μ μλ‹¤.    
      
## π“– @Primary VS @Qualifier
`@Primary` μ™€ `@Qualifier` μ¤‘μ— μ–΄λ–¤ κ²ƒμ„ μ‚¬μ©ν•λ©΄ μΆ‹μ„μ§€ κ³ λ―Όμ΄ λ  κ²ƒμ΄λ‹¤.      
      
**μ¶”μ² μ‚¬μ©**
* `@Qualifier`λ” λ¨λ“  μ½”λ“μ— `@Qualifier` λ¥Ό λ¶™μ—¬μ£Όμ–΄μ•Ό ν•λ‹¤. 
* `@Primary`λ” μ—°κ΄€λ λΉλ“¤μ—μ„ λ‹¨ ν•λ²λ§ μ„ μ–Έν•λ©΄λλ‹¤.            
* κ²°κµ­, `@Qualifier` μ΄λ¦„μ„ λ§μ¶°μ£Όκ³  μ—¬λ¬κ³³μ— μ„ μ–Έν•΄μ•Όν•λ‹ κ΄€λ¦¬ν•κΈ° μ–΄λ µλ‹¤.        
* **κ·Έλ ‡κΈ°μ— @Primary λ¥Ό μ‚¬μ©ν•λ” κ²ƒμ„ μ¶”μ²ν•λ‹¤**       	    
* λ¬Όλ΅ , 2κ°λ¥Ό νΌν•©ν•΄μ„ μ‚¬μ©ν•΄λ„ λλ‹¤.  	         
       
**μ°μ„ μμ„**      
* `@Primary`μ™€ `@Qualifier` 2κ°κ°€ ν•¨κ» μ‚¬μ©λλ‹¤λ©΄ **@Qualifier** κ°€ μ°μ„ κ¶μ΄ λ†’λ‹¤.     
   
# List, Map μ£Όμ…λ°›κΈ°   
`List`, `Map`κ³Ό κ°™μ€ **μ»¬λ ‰μ… ν”„λ μ„μ›ν¬λ¥Ό μμ΅΄κ΄€κ³„ μ£Όμ… λ°›μ„ μ μλ‹¤.**          
      
**κ·Έλ°λ° μ–΄λ–»κ² μ‚¬μ©μ„ ν•μ§€? π¤”**                       
* μ¤ν”„λ§ μ»¨ν…μ΄λ„μ— `κ°™μ€ νƒ€μ…μ μ—¬λ¬ λΉ`μ΄ μ΅΄μ¬ν•  κ²½μ°    
* ν•„λ“λ‚ νλΌλ―Έν„° λ³€μμ νƒ€μ…μ΄ `Collection`,`List`, `Map`μΌ κ²½μ°  
   
μ„μ™€ κ°™μ€ μ΅°κ±΄μ„ λ§μ΅±ν•  κ²½μ°, **μ»¬λ ‰μ…μΌλ΅ λ„κ²¨μ£Όμ–΄ ν• λ²μ— μμ΅΄ κ΄€κ³„λ¥Ό λ§Ίκ² ν•΄μ¤€λ‹¤.**             
  
```java
@Service
public class SampleService {
    
    private final List<DiscountPolicy> discountPolicies;
    
    public SampleService(List<DiscountPolicy> discountPolicies) {
        this.discountPolicies = discountPolicies;
    }
}
```
             
μ΄ μ μ„ μ μ΄μ©ν•λ‹¤λ©΄, `Map`μ—μ„ κ°κ°μ κ°μ²΄λ¥Ό λ°”λ΅ κΊΌλ‚΄ μ½”λ“μ λ³€κ²½μ—†μ΄ λ‹¤μ–‘ν• μ „λµμ„ κµ¬ν„μ‹ν‚¬ μ μλ‹¤.        
  
# π““ Autowired λ™μ‘ μ›λ¦¬  
`@Autowired` μ–΄λ…Έν…μ΄μ…μ€ `BeanPostProcessor`λΌλ” λΌμ΄ν”„ μ‚¬μ΄ν΄ μΈν„°νμ΄μ¤μ κµ¬ν„μ²΄μΈ    
`AutowiredAnnotationBeanPostProcessor`μ— μν•΄ μμ΅΄μ„± μ£Όμ…μ΄ μ΄λ£¨μ–΄μ§„λ‹¤.  

## π“– BeanPostProcessor     
`BeanPostProcessor`λ” λΉκ³Ό κ΄€λ ¨λ λΌμ΄ν”„ μ‚¬μ΄ν΄ μΈν„°νμ΄μ¤μ κµ¬ν„μ²΄μ΄λ‹¤.        
   
**μ¤ν”„λ§ λΉμ μ΄λ²¤νΈ λΌμ΄ν”„μ‚¬μ΄ν΄**  
1. μ¤ν”„λ§ μ»¨ν…μ΄λ„ μƒμ„±
2. μ¤ν”„λ§ λΉ μƒμ„±     
3. μμ΅΄κ΄€κ³„ μ£Όμ…   
4. μ΄κΈ°ν™” μ½λ°± : **BeanPostProcessorλ” μ „/ν›„λ΅ μ‹¤ν–‰λλ‹¤.(λ³„λ„μ λΌμ΄ν”„μ‚¬μ΄ν΄ μ κ³µ)**     
    * postProcessBeforeInitialization() μ— μ „λ‹¬
    * μ΄κΈ°ν™” μ½λ°±
    *  postProcessAfterInitialization() μ— μ „λ‹¬
6. μ‚¬μ©  
7. μ†λ©Έ μ „ μ½λ°±  
8. μ¤ν”„λ§ μΆ…λ£    
  
* λΉ(Bean)μ μ„¤μ •μ„ ν›„μ²λ¦¬(postprocessing)ν•¨μΌλ΅μ¨ λΉμ μƒλ… μ£ΌκΈ°μ™€ λΉ ν©ν† λ¦¬μ μƒλ…μ£ΌκΈ°μ— κ΄€μ—¬ν•λ‹¤.  
* `λΉμ΄ μ΄κΈ°ν™” λκΈ° μ „` `λΉμ΄ μ΄κΈ°ν™” λ ν›„`μ— λ€ν• 2κ°μ λ©”μ„λ“λ¥Ό μ κ³µ.   
    ```java
	@Nullable
	default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
		return bean;
	}

	@Nullable
	default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
		return bean;
	}
    ```
* λΉ ν”„λ΅νΌν‹°μ μ ν¨μ„± κ²€μ‚¬ λ“±μ— μ‚¬μ©λλ‹¤. -> μ΄κ±΄ μΆ€ μ΅°μ‚¬ν•΄λ³Ό ν•„μ”κ°€ μλ„¤μ”            
* λ‹¤λ¥Έ μ΄κΈ°ν™” λ©”μ†λ“μΈ `afterPropertiesSet()`κ³Ό `init-method`κ°€ νΈμ¶λκΈ° μ§μ „κ³Ό μ§ν›„μ— νΈμ¶λμ–΄μ§„λ‹¤.        
* μ¦‰, `λ‹¤λ¥Έ λΌμ΄ν”„ μ‚¬μ΄ν΄ μΈν„°νμ΄μ¤μ λ©”μ„λ“`κ°€ νΈμ¶λκΈ° μ „/ν›„ λ™μ‘μ„ μ²λ¦¬ν•λ” `λ³„κ°μ λΌμ΄ν”„ μ‚¬μ΄ν΄ μΈν„°νμ΄μ¤`μ΄λ‹¤.          
 
     
# μ°Έκ³  
[π’Ύ Knowledge Repository](https://atoz-develop.tistory.com/entry/Spring-Autowired-%EB%8F%99%EC%9E%91-%EC%9B%90%EB%A6%AC-BeanPostProcessor)   
[μ΄λ¬μΏµμ €λ¬μΏµ](https://ooz.co.kr/217)   
